<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>How to Encrypt Git Files - ByteWars</title><meta name=Description content="使用git-crypt加密git敏感文件"><meta property="og:title" content="How to Encrypt Git Files"><meta property="og:description" content="使用git-crypt加密git敏感文件"><meta property="og:type" content="article"><meta property="og:url" content="https://bytewars.github.io/2020/07/how-to-crypt-git-files/"><meta property="og:image" content="https://bytewars.github.io"><meta property="article:published_time" content="2020-07-12T11:00:42+08:00"><meta property="article:modified_time" content="2020-07-13T21:19:50+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bytewars.github.io"><meta name=twitter:title content="How to Encrypt Git Files"><meta name=twitter:description content="使用git-crypt加密git敏感文件"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://bytewars.github.io/2020/07/how-to-crypt-git-files/><link rel=prev href=https://bytewars.github.io/2020/07/%E5%9F%BA%E4%BA%8Edeno%E7%9A%84%E4%B8%80%E6%AC%A1tdd%E5%AE%9E%E8%B7%B5/><link rel=next href=https://bytewars.github.io/2020/08/%E5%A6%82%E4%BD%95%E5%86%99%E4%B8%80%E4%BB%BD%E5%90%88%E6%A0%BC%E7%9A%84adr/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"How to Encrypt Git Files","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/bytewars.github.io\/2020\/07\/how-to-crypt-git-files\/"},"image":{"@type":"ImageObject","url":"https:\/\/bytewars.github.io\/cover.png","width":800,"height":600},"genre":"posts","keywords":"git-crypt, crypt, RSA, secret, gpg, gnuPG, gpg, 加密🔐, transcrypt","wordcount":2668,"url":"https:\/\/bytewars.github.io\/2020\/07\/how-to-crypt-git-files\/","datePublished":"2020-07-12T11:00:42+08:00","dateModified":"2020-07-13T21:19:50+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/bytewars.github.io\/logo.png","width":127,"height":40}},"author":{"@type":"Person","name":"谷中仁"},"description":"使用git-crypt加密git敏感文件"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=ByteWars><span class=header-title-pre></span><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/ByteWars/bytewars.github.io title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/2020/07/how-to-crypt-git-files/ selected>简体中文</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=ByteWars><span class=header-title-pre></span><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>所有文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/about/>关于</a><a class=menu-item href=https://github.com/ByteWars/bytewars.github.io title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/2020/07/how-to-crypt-git-files/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">How to Encrypt Git Files</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://guzhongren.github.io title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>谷中仁</a></span>&nbsp;
<span class=post-category>收录于<a href=/categories/git/>
<i class="far fa-folder fa-fw"></i>git</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-07-12>2020-07-12</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2668 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;<span id=/2020/07/how-to-crypt-git-files/ class=leancloud_visitors data-flag-title="How to Encrypt Git Files">
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading/normal.min.svg data-src=https://s1.ax1x.com/2020/07/12/U32INn.png data-srcset="https://s1.ax1x.com/2020/07/12/U32INn.png, https://s1.ax1x.com/2020/07/12/U32INn.png 1.5x, https://s1.ax1x.com/2020/07/12/U32INn.png 2x" data-sizes=auto alt=使用git-crypt加密git敏感文件 title=使用git-crypt加密git敏感文件></div><div class="details toc" id=toc-static><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#为什么需要crypt>为什么需要crypt</a><ul><li><a href=#分析>分析</a></li></ul></li><li><a href=#有哪些方案呢>有哪些方案呢?</a><ul><li><a href=#gpg>GPG</a></li></ul></li><li><a href=#git-crypt-操作>git-crypt 操作</a><ul><li><a href=#安装gpg-和-git-crypt>安装gpg 和 git-crypt</a></li><li><a href=#gpg-version>gpg version</a></li><li><a href=#生成gpg-userid>生成gpg userId</a></li><li><a href=#获取userid>获取UserID</a></li></ul></li><li><a href=#git-crypt-操作-1>git-crypt 操作</a><ul><li><a href=#初始化>初始化</a></li><li><a href=#加密文件过滤器gitattributes>加密文件过滤器<code>.gitattributes</code></a></li><li><a href=#清理-config-的-git-缓存>清理 config 的 git 缓存</a></li><li><a href=#添加需要加密的文件和数据>添加需要加密的文件和数据</a></li><li><a href=#上传到-git-仓库>上传到 git 仓库</a></li></ul></li><li><a href=#协作>协作</a><ul><li><a href=#导出密钥>导出密钥</a></li><li><a href=#更新密钥>更新密钥</a></li><li><a href=#总结>总结</a></li></ul></li><li><a href=#reference>Reference</a></li><li><a href=#hereby-declared特此申明>Hereby declared（特此申明）</a></li></ul></nav></div></div><div class=content id=content><h2 id=为什么需要crypt>为什么需要crypt</h2><p>在开发过程中经常会遇到一个问题：</p><blockquote><p>怎么将敏感数据让特定的人获取到？</p></blockquote><p>常用的解决方法如下：</p><ul><li>使用如 AWS 的 KMS, ParameterStore等服务，给不同的用户以访问该数据的角色；</li><li>有专人托管，在需要的时候联系他，由特定方式转发给你，如加密邮件等</li></ul><h3 id=分析>分析</h3><ul><li>对于第二种方式，相对简单粗暴，但是不利于管理。</li><li>第一种方案，你需要依托第三方服务，你得绝对信任他，相信他是不会出问题的；再者，你的数据管理也需要有特定的规范，不然你都不知道你存储了什么数据，更不知道有哪些数据。</li></ul><p>针对第一种情况，当我们的数据越来多的时候，我们需要将其状态可控起来，其实就是 <code>date as code</code>, 每次对数据的增删改查，我们都可以有追踪和数据保存。</p><h2 id=有哪些方案呢>有哪些方案呢?</h2><ul><li><a href=https://github.com/AGWA/git-crypt target=_blank rel="noopener noreffer">git-crypt</a></li><li><a href=https://github.com/elasticdog/transcrypt target=_blank rel="noopener noreffer">transcrypt</a></li></ul><p>在这里，我推荐使用 <code>git-crypt</code>, 其特点如下：</p><ul><li>加密后上传git，在git上保存的是<code>二进制</code>文件；</li><li>分发<code>密钥</code>给可信开发人员，进行解密，维护配置文件;</li><li>解密后为明文内容，如需上传，不用再进行加密，工具<code>自动</code>(配合<code>git hook</code>)会生成最新的二进制文件后上传;</li><li>由<code>c++</code>编写；</li><li>Mac 可以通过<code>brew等</code>方式下载;</li><li>利用了加密工具<code>gpg</code>进行加密处理。</li></ul><h3 id=gpg>GPG</h3><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://ruanyifeng.com/blogimg/asset/201307/bg2013071202.png data-srcset="https://ruanyifeng.com/blogimg/asset/201307/bg2013071202.png, https://ruanyifeng.com/blogimg/asset/201307/bg2013071202.png 1.5x, https://ruanyifeng.com/blogimg/asset/201307/bg2013071202.png 2x" data-sizes=auto alt=GPG title=GPG></p><p>要了解什么是GPG，就要先了解PGP。</p><p>1991年，程序员Phil Zimmermann为了避开政府监视，开发了加密软件PGP。这个软件非常好用，迅速流传开来，成了许多程序员的必备工具。但是，它是商业软件，不能自由使用。所以，自由软件基金会决定，开发一个PGP的替代品，取名为GnuPG。这就是GPG的由来。</p><p>gpg 可以对密钥的<code>增删改查</code>进行操作,也可以将公钥发送到pgp等服务器，让别人搜索到你，具体操作可以参考阮一峰的这篇博文 <a href=https://ruanyifeng.com/blog/2013/07/gpg.html target=_blank rel="noopener noreffer">《GPG入门教程》</a></p><h2 id=git-crypt-操作>git-crypt 操作</h2><h3 id=安装gpg-和-git-crypt>安装gpg 和 git-crypt</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>brew install git-crypt
brew install gpg
</code></pre></td></tr></table></div></div><h3 id=gpg-version>gpg version</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>gpg --version
gpg <span class=o>(</span>GnuPG<span class=o>)</span> 2.2.19
libgcrypt 1.8.5
Copyright <span class=o>(</span>C<span class=o>)</span> <span class=m>2019</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class=m>3</span> or later &lt;https://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Home: /Users/c4/.gnupg
支持的算法：
公钥： RSA, ELG, DSA, ECDH, ECDSA, EDDSA
密文： IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
    CAMELLIA128, CAMELLIA192, CAMELLIA256
散列： SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
压缩：  不压缩, ZIP, ZLIB, BZIP2
</code></pre></td></tr></table></div></div><h3 id=生成gpg-userid>生成gpg userId</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>gpg --full-generate-key
gpg <span class=o>(</span>GnuPG<span class=o>)</span> 2.2.19<span class=p>;</span> Copyright <span class=o>(</span>C<span class=o>)</span> <span class=m>2019</span> Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

请选择您要使用的密钥类型：
   <span class=o>(</span>1<span class=o>)</span> RSA 和 RSA （默认）
   <span class=o>(</span>2<span class=o>)</span> DSA 和 Elgamal
   <span class=o>(</span>3<span class=o>)</span> DSA（仅用于签名）
   <span class=o>(</span>4<span class=o>)</span> RSA（仅用于签名）
  <span class=o>(</span>14<span class=o>)</span> Existing key from card
您的选择是？
RSA 密钥的长度应在 <span class=m>1024</span> 位与 <span class=m>4096</span> 位之间。
您想要使用的密钥长度？<span class=o>(</span>2048<span class=o>)</span> <span class=m>4096</span>
请求的密钥长度是 <span class=m>4096</span> 位
请设定这个密钥的有效期限。
         <span class=nv>0</span> <span class=o>=</span> 密钥永不过期
      &lt;n&gt;  <span class=o>=</span> 密钥在 n 天后过期
      &lt;n&gt;w <span class=o>=</span> 密钥在 n 周后过期
      &lt;n&gt;m <span class=o>=</span> 密钥在 n 月后过期
      &lt;n&gt;y <span class=o>=</span> 密钥在 n 年后过期
密钥的有效期限是？<span class=o>(</span>0<span class=o>)</span>
密钥永远不会过期
这些内容正确吗？ <span class=o>(</span>y/N<span class=o>)</span> y

GnuPG 需要构建用户标识以辨认您的密钥。

真实姓名： guzhongren
电子邮件地址： guzhongren@live.cn
注释： guzhongren
您选定了此用户标识：
    “guzhongren <span class=o>(</span>guzhongren<span class=o>)</span> &lt;guzhongren@live.cn&gt;”

更改姓名（N）、注释（C）、电子邮件地址（E）或确定（O）/退出（Q）？ o
我们需要生成大量的随机字节。在质数生成期间做些其他操作（敲打键盘
、移动鼠标、读写硬盘之类的）将会是一个不错的主意；这会让随机数
发生器有更好的机会获得足够的熵。
我们需要生成大量的随机字节。在质数生成期间做些其他操作（敲打键盘
、移动鼠标、读写硬盘之类的）将会是一个不错的主意；这会让随机数
发生器有更好的机会获得足够的熵。
gpg: 密钥 25DD25A47AEF036A 被标记为绝对信任
gpg: 吊销证书已被存储为‘/Users/c4/.gnupg/openpgp-revocs.d/4FA612D2DB4244E7D64A1C1025DD25A47AEF036A.rev’
公钥和私钥已经生成并被签名。

pub   rsa4096 2020-07-11 <span class=o>[</span>SC<span class=o>]</span>
      4FA612D2DB4244E7D64A1C1025DD25A47AEF036A
uid                      guzhongren <span class=o>(</span>guzhongren<span class=o>)</span> &lt;guzhongren@live.cn&gt;
sub   rsa4096 2020-07-11 <span class=o>[</span>E<span class=o>]</span>
</code></pre></td></tr></table></div></div><h3 id=获取userid>获取UserID</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>gpg --list-secret-keys --keyid-format LONG
gpg: 正在检查信任度数据库
gpg: 绝对信任密钥 8823E362E95562B8 的公钥未找到
gpg: marginals needed: <span class=m>3</span>  completes needed: <span class=m>1</span>  trust model: pgp
gpg: 深度：0  有效性：  <span class=m>4</span>  已签名：  <span class=m>0</span>  信任度：0-，0q，0n，0m，0f，4u
gpg: 下次信任度数据库检查将于 2022-01-26 进行
/Users/c4/.gnupg/pubring.kbx
----------------------------
sec   rsa4096/25DD25A47AEF036A 2020-07-11 <span class=o>[</span>SC<span class=o>]</span>
      4FA612D2DB4244E7D64A1C1025DD25A47AEF036A
uid                 <span class=o>[</span> 绝对 <span class=o>]</span> guzhongren <span class=o>(</span>guzhongren<span class=o>)</span> &lt;guzhongren@live.cn&gt;
ssb   rsa4096/DCC72940818AB355 2020-07-11 <span class=o>[</span>E<span class=o>]</span>

</code></pre></td></tr></table></div></div><p><code>sec rsa4096/25DD25A47AEF036A 2020-07-11 [SC]</code> 中 <code>25DD25A47AEF036A</code>就是gpg userId</p><h2 id=git-crypt-操作-1>git-crypt 操作</h2><h3 id=初始化>初始化</h3><p>进入需要做加密的git repo 做 git-crypt 初始化操作,并将上面获取到的gpg userId 添加进去</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>git-crypt init
git-crypt add-gpg-user 25DD25A47AEF036A
</code></pre></td></tr></table></div></div><h3 id=加密文件过滤器gitattributes>加密文件过滤器<code>.gitattributes</code></h3><p>格式为： * filter=git-crypt diff=git-crypt ；如下，我需要加密<code>secretfile</code>, <code>*.key</code>和<code>secretdir/**</code>, 那么内容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>secretfile filter=git-crypt diff=git-crypt
*.key filter=git-crypt diff=git-crypt
secretdir/** filter=git-crypt diff=git-crypt
</code></pre></td></tr></table></div></div><h3 id=清理-config-的-git-缓存>清理 config 的 git 缓存</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>git rm -r –cached config
</code></pre></td></tr></table></div></div><h3 id=添加需要加密的文件和数据>添加需要加密的文件和数据</h3><p>在<code>secretdir</code>文件夹下添加 <code>secret.yaml</code>,并添加如下内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml>username<span class=p>:</span>password<span class=w>
</span></code></pre></td></tr></table></div></div><h3 id=上传到-git-仓库>上传到 git 仓库</h3><p>此步不用担心你的<code>secret.yaml</code>文件以明文的形式上传，git-crypt会在 commit 之前将过滤后的数据加密成二进制，所以不用担心在仓库中存储敏感信息。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>git add .
git commit -m ‘git-crypt’
git push
</code></pre></td></tr></table></div></div><p>如果你去git仓库中浏览secret.yaml文件，会是一个二进制文件，如图：</p><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://i.loli.net/2020/07/12/lXVnNw5EbKCcvhe.png data-srcset="https://i.loli.net/2020/07/12/lXVnNw5EbKCcvhe.png, https://i.loli.net/2020/07/12/lXVnNw5EbKCcvhe.png 1.5x, https://i.loli.net/2020/07/12/lXVnNw5EbKCcvhe.png 2x" data-sizes=auto alt=git-crypt.png title=git-crypt.png></p><h2 id=协作>协作</h2><p>与他人协作，别人需要知道对应解密的key</p><h3 id=导出密钥>导出密钥</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>git-crypt export-key ~/Desktop/git-crypt.key
</code></pre></td></tr></table></div></div><p>得到git-crypt.key后，将该密钥分发给可信的团队成员，团队成员将仓库 clone 下来后，使用如下命令解密即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>git-crypt unlock /path/to/git-crypt.key
</code></pre></td></tr></table></div></div><p>此时，在本地就可以看到加密后的文件内容了。</p><h3 id=更新密钥>更新密钥</h3><p>因为git-crypt没有提供删除或者更新密钥的命令，所以参考了一个issue: <a href=https://github.com/AGWA/git-crypt/issues/47#issuecomment-492939759;>https://github.com/AGWA/git-crypt/issues/47#issuecomment-492939759;</a>步骤如下：</p><ul><li>Make a backup (with decrypted files): cp -r . /path/to/backup</li><li>Save a list of files that are encrypted: git crypt status | grep -v &lsquo;not encrypted&rsquo; > ../encrypted-files.txt</li><li>Make git-crypt forget about itself: rm .git-crypt</li><li>Delete the encrypted files: awk &lsquo;{print $2}&rsquo; ../encrypted-files.txt | xargs rm</li><li>Commit (at this point you get a repo without git-crypt stuff)</li><li>Add git-crypt from scratch (init and add-gpg-user)</li><li>Copy the decrypted files from the backup: awk &lsquo;{print $2}&rsquo; ../encrypted-files.txt | while read l; do cp /path/to/backup/$l $l; done</li><li>Commit (at this point you are done, but be sure to verify things are properly encrypted before publishing)</li></ul><p>实践结果：在更新完成之后，协作者需要重新clone 仓库，然后用新的密钥来解密，对密钥管理者来说操作比较麻烦</p><h3 id=总结>总结</h3><p>在敏感数据越来越多的时候，作为开发者，我们更应该将所有的数据都<code>as code</code>,为以后维护提供方便。<code>git-crypt</code>确实是一个比较好的选择。</p><p>但是<code>git-crypt</code>有一个最大的缺点：</p><ul><li>只能添加不能删除 gpg userId, 导致更新密钥会比较麻烦，如果要更新密钥，那么就需要做重置</li></ul><h2 id=reference>Reference</h2><ul><li><a href=https://github.com/beef-noodles/git-crypt-test target=_blank rel="noopener noreffer">Demo: git-crypt-test</a></li><li><a href=https://guzhongren.github.io/ target=_blank rel="noopener noreffer">博客:https://guzhongren.github.io/</a></li><li><a href=https://sm.ms/ target=_blank rel="noopener noreffer">图床:https://sm.ms/</a></li><li><a href=https://gnupg.org/ target=_blank rel="noopener noreffer">https://gnupg.org/</a></li><li><a href=https://github.com/AGWA/git-crypt target=_blank rel="noopener noreffer">AGWA/git-crypt</a></li><li><a href=http://einverne.github.io/post/2019/11/git-crypt-usage.html target=_blank rel="noopener noreffer">git-crypt 使用</a></li><li><a href=https://www.jianshu.com/p/a40fc90df943 target=_blank rel="noopener noreffer">git上的配置文件如何加密？</a></li><li><a href=https://www.devopsgroup.com/blog/easy-git-crypt-user-identification/ target=_blank rel="noopener noreffer">Easy Git Crypt User Identification</a></li><li><a href=https://github.com/AGWA/git-crypt/issues/47#issuecomment-492939759 target=_blank rel="noopener noreffer">Update git crypt key</a></li><li><a href=https://github.com/AGWA/git-crypt/issues/189#issuecomment-549787656 target=_blank rel="noopener noreffer">List gpg user</a></li><li><a href=https://www.gnupg.org/howtos/zh/index.html target=_blank rel="noopener noreffer">Gnu 隐私卫士 (GnuPG) 袖珍 HOWTO (中文版)</a></li><li><a href=https://www.lnmpy.com/blog/transcrypt-intro/ target=_blank rel="noopener noreffer">transcrypt使用案例</a></li></ul><h2 id=hereby-declared特此申明>Hereby declared（特此申明）</h2><p>本文仅代表个人观点，与<a href=https://www.thoughtworks.com/ target=_blank rel="noopener noreffer">ThoughtWorks</a> 公司无任何关系。</p><hr><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://s1.ax1x.com/2020/05/23/Yx1I5q.png data-srcset="https://s1.ax1x.com/2020/05/23/Yx1I5q.png, https://s1.ax1x.com/2020/05/23/Yx1I5q.png 1.5x, https://s1.ax1x.com/2020/05/23/Yx1I5q.png 2x" data-sizes=auto alt=微信公众号 title=微信公众号></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>本文于 2020-07-13 更新&nbsp;<a class=git-hash href=https://github.com/ByteWars/bytewars.github.io/commit/e4fd35f9a0bf973fe6020180b2eae7f7926ec58a target=_blank title="commit by guzhongren(guzhongren@live.cn) e4fd35f9a0bf973fe6020180b2eae7f7926ec58a: fix(post): 修改错别字">
<i class="fas fa-hashtag fa-fw"></i>e4fd35f</a></span></div><div class=post-info-license><span>采用 Creative Commons Attribution 4.0 International license 协议发布</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2020/07/how-to-crypt-git-files/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://bytewars.github.io/2020/07/how-to-crypt-git-files/ data-title="How to Encrypt Git Files" data-hashtags=git-crypt,crypt,RSA,secret,gpg,gnuPG,gpg,加密🔐,transcrypt><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://bytewars.github.io/2020/07/how-to-crypt-git-files/ data-hashtag=git-crypt><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://bytewars.github.io/2020/07/how-to-crypt-git-files/ data-title="How to Encrypt Git Files" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://bytewars.github.io/2020/07/how-to-crypt-git-files/ data-title="How to Encrypt Git Files"><i data-svg-src=/lib/simple-icons/icons/line.min.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://bytewars.github.io/2020/07/how-to-crypt-git-files/ data-title="How to Encrypt Git Files" data-image=https://s1.ax1x.com/2020/07/12/U32INn.png><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://bytewars.github.io/2020/07/how-to-crypt-git-files/ data-title="How to Encrypt Git Files" data-description=使用git-crypt加密git敏感文件><i data-svg-src=/lib/simple-icons/icons/myspace.min.svg></i></a><a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://bytewars.github.io/2020/07/how-to-crypt-git-files/ data-title="How to Encrypt Git Files" data-description=使用git-crypt加密git敏感文件><i class="fab fa-blogger fa-fw"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://bytewars.github.io/2020/07/how-to-crypt-git-files/ data-title="How to Encrypt Git Files"><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/git-crypt/>git-crypt</a>,&nbsp;<a href=/tags/crypt/>crypt</a>,&nbsp;<a href=/tags/rsa/>RSA</a>,&nbsp;<a href=/tags/secret/>secret</a>,&nbsp;<a href=/tags/gpg/>gpg</a>,&nbsp;<a href=/tags/gnupg/>gnuPG</a>,&nbsp;<a href=/tags/gpg/>gpg</a>,&nbsp;<a href=/tags/%E5%8A%A0%E5%AF%86/>加密🔐</a>,&nbsp;<a href=/tags/transcrypt/>transcrypt</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2020/07/%E5%9F%BA%E4%BA%8Edeno%E7%9A%84%E4%B8%80%E6%AC%A1tdd%E5%AE%9E%E8%B7%B5/ class=prev rel=prev title=基于Deno的一次TDD实践><i class="fas fa-angle-left fa-fw"></i>基于Deno的一次TDD实践</a>
<a href=/2020/08/%E5%A6%82%E4%BD%95%E5%86%99%E4%B8%80%E4%BB%BD%E5%90%88%E6%A0%BC%E7%9A%84adr/ class=next rel=next title=如何写一份合格的ADR>如何写一份合格的ADR<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.8"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://bytewars.github.io/ target=_blank>ByteWars</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><script type=text/javascript src=/lib/valine/Valine.min.js></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"valine":{"appId":"SeaYceIbw6Aph0HmzJVy6hKj-gzGzoHsz","appKey":"SaDhsQdm5hz6YL46efubYAnQ","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"visitor":true}},"data":{"id-1":"\u003c01/\u003e","id-2":"\u003c01/\u003e"},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>